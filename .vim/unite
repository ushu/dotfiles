" load ag
if executable('ag')
  let g:unite_source_rec_async_command='ag --nocolor --nogroup --skip-vcs-ignores --ignore ''.hg'' --ignore ''.svn'' --ignore ''.git'' --ignore ''.bzr'' --ignore ''_darcs'' --ignore ''bundle/'' --ignore ''tmp/'' --hidden -g ""'
  let g:unite_source_grep_command = 'ag'
  let g:unite_source_grep_default_opts = '--nogroup --nocolor --column'
  let g:unite_source_grep_recursive_opt = ''
endif

" Unite for search/completion
NeoBundle 'Shougo/unite.vim', {
      \ 'depends' : 'vimproc',
      \ 'autoload' : {
      \   'commands' : [ "Unite", "UniteWithCursorWord" ]
      \ }
      \}

NeoBundleLazy 'Shougo/unite-outline', { 'autoload' : { 'unite_sources': 'outline' }}
NeoBundleLazy 'basyura/unite-rails', { 'autoload': { 'unite_sources': ['rails/model', 'rails/controller', 'rails/view', 'rails/helper', 'rails/mailer', 'rails/config', 'rails/route'] }}
NeoBundleLazy 'choplin/unite-spotlight', { 'autoload': { 'unite_sources': ['spotlight'] }}
NeoBundleLazy 'ujihisa/unite-gem', { 'autoload': { 'unite_sources': ['gem'] }}
NeoBundleLazy 'simonschiele/unite-cleanup', { 'autoload' : { 'unite_sources' : ['cleanup'] }}
"
if executable('ag')
  let g:unite_source_rec_async_command='ag --nocolor --nogroup --skip-vcs-ignores --ignore ''.hg'' --ignore ''.svn'' --ignore ''.git'' --ignore ''.bzr'' --ignore ''_darcs'' --ignore ''bundle/'' --ignore ''tmp/'' --hidden -g ""'
  let g:unite_source_grep_command = 'ag'
  let g:unite_source_grep_default_opts = '--nogroup --nocolor --column'
  let g:unite_source_grep_recursive_opt = ''
endif

" basic conf for Unite: matcher and filters
" ideas here: https://raw.github.com/Shougo/shougo-s-github/master/vim/.vimrc
"call unite#filters#matcher_default#use(['converter_tail', 'matcher_fuzzy'])
call unite#filters#matcher_default#use(['matcher_fuzzy'])
call unite#custom#source('file_mru', 'max_candidates', 5)
call unite#custom#source('file_rec/async', 'sorters', 'sorter_length')
call unite#custom#source('file_rec/async', 'ignore_pattern', '(vendor/\|log/\|tmp/\|.git)')

" key bindings
nnoremap <c-I> :Unite -start-insert file_rec/async:<cr>
nnoremap <leader>i :Unite -resume file_rec/async:<cr>
nnoremap <leader>/ :Unite grep:.<cr>
nnoremap <leader>. :Unite outline<cr>
nnoremap <leader><space> :Unite -start-insert source<cr>
nnoremap <leader>r :Unite -start-insert -immediately rails/model rails/controller rails/view rails/helper rails/mailer rails/route<cr>
"
